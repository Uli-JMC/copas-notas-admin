<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="theme-color" content="#000000" />
  <title>Admin | Entre Copas &amp; Notas</title>
  <meta name="description" content="Panel de administración para eventos e inscripciones." />
  <link rel="stylesheet" href="./css/admin.css" />
</head>

<body class="adminPage" data-page="admin">
  <div class="toasts" id="toasts" aria-live="polite" aria-relevant="additions"></div>

  <!-- TOPBAR -->
  <header class="topbar">
    <div class="container">
      <div class="nav">
        <a class="brand" href="https://copas-notas-public.netlify.app/" aria-label="Ir al sitio público">
          <img id="adminLogo" src="./assets/img/logocuadrado-entrecopasynotas.png" alt="Logo" />
          <span>Admin · Entre Copas &amp; Notas</span>
        </a>

        <div class="navRight">
          <a class="btn" href="https://copas-notas-public.netlify.app/#proximos">Ver sitio</a>
          <button class="btn" id="logoutBtn" type="button">Salir</button>
        </div>
      </div>
    </div>
  </header>

  <!-- MAIN -->
  <main class="page">
    <div class="container">

      <section class="app" id="appPanel">
        <div class="head">
          <div>
            <p class="kicker">Gestión</p>
            <h2 class="h2">Panel de administración</h2>
            <p class="sub">Eventos, fechas, cupos, inscripciones y recursos visuales.</p>
          </div>

          <div class="headActions">
            <input
              class="search"
              id="search"
              type="search"
              placeholder="Buscar evento o inscripción…"
              aria-label="Buscar"
              autocomplete="off"
            />
          </div>
        </div>

        <!-- TABS -->
        <div class="tabs" role="tablist" aria-label="Secciones">
          <button class="tab" data-tab="events" aria-selected="true" type="button">Eventos</button>
          <button class="tab" data-tab="dates" aria-selected="false" type="button">Fechas</button>
          <button class="tab" data-tab="regs" aria-selected="false" type="button">Inscripciones</button>
          <button class="tab" data-tab="media" aria-selected="false" type="button">Medios</button>
          <button class="tab" data-tab="gallery" aria-selected="false" type="button">Galería</button>
          <button class="tab" data-tab="promos" aria-selected="false" type="button">Promos</button>
        </div>

        <!-- =====================================================
             EVENTS (ALINEADO con admin.js PRO)
        ====================================================== -->
        <section class="panel" id="tab-events" role="tabpanel">
          <div class="grid2">
            <div class="card">
              <div class="cardHead">
                <h3 class="h3">Eventos</h3>
                <div class="mini">Crear, editar y publicar eventos.</div>
              </div>

              <div class="listHead">
                <div class="pill">Lista</div>
                <div class="actions">
                  <button class="btn btn--ghost" id="newEventBtn" type="button">Nuevo</button>
                  <button class="btn btn--ghost" id="dupEventBtn" type="button">Duplicar</button>
                </div>
              </div>

              <!-- ✅ admin.js PRO usa #eventList -->
              <div class="list" id="eventList" aria-label="Lista de eventos">
                <!-- JS -->
              </div>

              <div class="empty" id="eventsEmpty" hidden>
                Aún no hay eventos. Creá el primero con “Nuevo”.
              </div>

              <!-- ✅ admin.js PRO escribe aquí estados -->
              <div class="note" id="storageNote" aria-live="polite"></div>
            </div>

            <div class="card">
              <div class="cardHead">
                <h3 class="h3">Editor</h3>
                <div class="mini">Completá la info del evento y guardá cambios.</div>
              </div>

              <!-- ✅ admin.js PRO usa editorEmpty para when no selection -->
              <div class="empty" id="editorEmpty">
                Seleccioná un evento de la lista para editarlo.
              </div>

              <form class="form" id="eventForm" autocomplete="off" hidden>
                <input type="hidden" id="eventId" />

                <div class="row">
                  <div class="field">
                    <label class="label" for="evTitle">Título</label>
                    <input class="input" id="evTitle" type="text" required maxlength="80" />
                  </div>
                  <div class="field">
                    <label class="label" for="evType">Tipo</label>
                    <select class="select" id="evType" required>
                      <option value="Cata de vino">Vino / Cata</option>
                      <option value="Maridajes">Maridajes</option>
                      <option value="Cocteles">Cocteles</option>
                    </select>
                  </div>
                </div>

                <div class="row">
                  <div class="field">
                    <label class="label" for="evMonth">Mes</label>
                    <select class="select" id="evMonth" required>
                      <option>ENERO</option><option>FEBRERO</option><option>MARZO</option><option>ABRIL</option>
                      <option>MAYO</option><option>JUNIO</option><option>JULIO</option><option>AGOSTO</option>
                      <option>SEPTIEMBRE</option><option>OCTUBRE</option><option>NOVIEMBRE</option><option>DICIEMBRE</option>
                    </select>
                  </div>
                  <div class="field">
                    <label class="label" for="evImg">Imagen (url)</label>
                    <input class="input" id="evImg" type="text" placeholder="https://…" />
                  </div>
                </div>

                <div class="field">
                  <label class="label" for="evDesc">Descripción</label>
                  <textarea class="textarea" id="evDesc" rows="4" maxlength="520"></textarea>
                  <div class="mini">Caracteres: <span id="descCount">0</span>/520</div>
                </div>

                <div class="row">
                  <div class="field">
                    <label class="label" for="evLocation">Lugar</label>
                    <input class="input" id="evLocation" type="text" maxlength="80" />
                  </div>
                  <div class="field">
                    <label class="label" for="evTimeRange">Horario</label>
                    <input class="input" id="evTimeRange" type="text" placeholder="7:00pm - 9:00pm" maxlength="40" />
                  </div>
                </div>

                <div class="row">
                  <div class="field">
                    <label class="label" for="evDurationHours">Duración (horas)</label>
                    <input class="input" id="evDurationHours" type="text" placeholder="2" maxlength="10" />
                  </div>
                  <div class="field">
                    <label class="label" for="evDuration">Duración (texto)</label>
                    <input class="input" id="evDuration" type="text" placeholder="2 hrs" maxlength="30" />
                  </div>
                </div>

                <!-- hint fechas -->
                <div id="datesList"></div>

                <div class="formActions">
                  <button class="btn primary" id="saveEventBtn" type="submit">Guardar</button>
                  <button class="btn" id="deleteEventBtn" type="button">Eliminar</button>
                  <button class="btn btn--ghost" id="addDateBtn" type="button">Administrar fechas</button>
                </div>

                <div class="note" id="eventNote" aria-live="polite"></div>
              </form>
            </div>
          </div>
        </section>

        <!-- =====================================================
             DATES (ALINEADO con admin-dates.js PRO “UI nueva”)
        ====================================================== -->
        <section class="panel" id="tab-dates" role="tabpanel" hidden>
          <div class="grid2">
            <div class="card">
              <div class="cardHead">
                <h3 class="h3">Eventos</h3>
                <div class="mini">Seleccioná un evento para ver/crear fechas.</div>
              </div>

              <div class="toolbar">
                <button class="btn" id="datesRefreshBtn" type="button">Refrescar</button>
              </div>

              <div class="note" id="datesNote" aria-live="polite"></div>

              <!-- ✅ admin-dates.js PRO usa #datesEventList -->
              <div class="list" id="datesEventList"></div>
            </div>

            <div class="card">
              <div class="cardHead">
                <h3 class="h3" id="datesEventTitle">Fechas</h3>
                <div class="mini" id="datesEventMeta">—</div>
              </div>

              <div class="toolbar">
                <button class="btn primary" id="datesNewBtn" type="button">+ Nueva fecha</button>
              </div>

              <!-- estado -->
              <div class="empty" id="datesEmpty">
                Seleccioná un evento a la izquierda para administrar sus fechas.
              </div>

              <!-- ✅ editor (admin-dates.js PRO usa #datesEditor) -->
              <div id="datesEditor" hidden>
                <div class="list" id="datesListByEvent"></div>

                <form class="form" id="dateForm" autocomplete="off">
                  <input type="hidden" id="dateId" />

                  <div class="field">
                    <label class="label" for="dateLabel">Label</label>
                    <input class="input" id="dateLabel" type="text" placeholder="Sábado 18 • 7pm" maxlength="40" required />
                  </div>

                  <div class="row">
                    <div class="field">
                      <label class="label" for="dateSeatsTotal">Cupos totales</label>
                      <input class="input" id="dateSeatsTotal" type="number" min="0" step="1" value="0" />
                    </div>
                    <div class="field">
                      <label class="label" for="dateSeatsAvailable">Cupos disponibles</label>
                      <input class="input" id="dateSeatsAvailable" type="number" min="0" step="1" value="0" />
                    </div>
                  </div>

                  <div class="formActions">
                    <button class="btn primary" id="dateSaveBtn" type="submit">Guardar</button>
                    <button class="btn" id="dateClearBtn" type="button">Nueva</button>
                    <button class="btn" id="dateDeleteBtn" type="button" disabled>Eliminar</button>
                  </div>
                </form>
              </div>

            </div>
          </div>
        </section>

        <!-- =====================================================
             REGISTRATIONS (ALINEADO con admin-registrations.js PRO)
        ====================================================== -->
        <section class="panel" id="tab-regs" role="tabpanel" hidden>
          <div class="card">
            <div class="cardHead">
              <h3 class="h3">Inscripciones</h3>
              <div class="mini">Listado (solo lectura) con exportación CSV.</div>
            </div>

            <div class="toolbar">
              <button class="btn" id="seedRegsBtn" type="button">Refrescar</button>
              <button class="btn primary" id="exportCsvBtn" type="button">Exportar CSV</button>
            </div>

            <div class="tableWrap">
              <table class="table">
                <thead>
                  <tr>
                    <th>Evento</th>
                    <th>Fecha</th>
                    <th>Nombre</th>
                    <th>Email</th>
                    <th>Teléfono</th>
                    <th>Marketing</th>
                    <th>Creado</th>
                  </tr>
                </thead>
                <tbody id="regsTbody">
                  <!-- JS -->
                </tbody>
              </table>
            </div>
          </div>
        </section>

        <!-- =====================================================
             MEDIA
        ====================================================== -->
        <section class="panel" id="tab-media" role="tabpanel" hidden>
          <div class="card">
            <div class="cardHead">
              <h3 class="h3">Medios</h3>
              <div class="mini">Placeholder: luego se conecta a Storage.</div>
            </div>
            <div class="empty">Próximo: subida de imágenes y gestión de rutas.</div>
          </div>
        </section>

        <!-- =====================================================
             GALLERY
        ====================================================== -->
        <section class="panel" id="tab-gallery" role="tabpanel" hidden>
          <div class="card">
            <div class="cardHead">
              <h3 class="h3">Galería</h3>
              <div class="mini">Subí y organizá imágenes para Maridajes / Cocteles.</div>
            </div>

            <div class="toolbar">
              <button class="btn primary" id="newGalleryBtn" type="button">Nuevo ítem</button>
              <button class="btn" id="refreshGalleryBtn" type="button">Refrescar</button>
            </div>

            <div class="tableWrap">
              <table class="table">
                <thead>
                  <tr>
                    <th>Tipo</th>
                    <th>Nombre</th>
                    <th>Tags</th>
                    <th>Imagen</th>
                    <th>Creado</th>
                    <th>Acciones</th>
                  </tr>
                </thead>
                <tbody id="galleryTbody"></tbody>
              </table>
            </div>
          </div>
        </section>

        <!-- =====================================================
             PROMOS
        ====================================================== -->
        <section class="panel" id="tab-promos" role="tabpanel" hidden>
          <div class="card">
            <div class="cardHead">
              <h3 class="h3">Promos</h3>
              <div class="mini">Administración de promos.</div>
            </div>

            <div class="toolbar">
              <button class="btn primary" id="newPromoBtn" type="button">Nueva promo</button>
              <button class="btn" id="refreshPromosBtn" type="button">Refrescar</button>
            </div>

            <div class="tableWrap">
              <table class="table">
                <thead>
                  <tr>
                    <th>Tipo</th>
                    <th>Título</th>
                    <th>Target</th>
                    <th>Creado</th>
                    <th>Acciones</th>
                  </tr>
                </thead>
                <tbody id="promosTbody"></tbody>
              </table>
            </div>
          </div>
        </section>

      </section>
    </div>
  </main>

  <!-- SCRIPTS (ORDEN CRÍTICO) -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script src="./js/supabaseClient.js"></script>
  <script src="./js/admin-auth.js"></script>

  <script src="./js/admin.js"></script>
  <script src="./js/admin-dates.js"></script>
  <script src="./js/admin-registrations.js"></script>
  <script src="./js/admin-gallery.js"></script>
  <script src="./js/admin-promos.js"></script>
</body>
</html>
